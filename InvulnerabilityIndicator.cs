using Modding;
using System.Collections.Generic;
using UnityEngine;

namespace InvulnerabilityIndicator {
    public class InvulnerabilityIndicator : Mod, ITogglableMod {
        internal static InvulnerabilityIndicator instance;
        internal static bool assigned = false;

        public InvulnerabilityIndicator() : base("Invulnerability Indicator") {
           instance = this;
        }

        public override void Initialize(Dictionary<string, Dictionary<string, GameObject>> preloadedObjects) {
            ModHooks.HeroUpdateHook += addIndicator;
            ModHooks.SavegameLoadHook += resetIndicator;
        }

        public override string GetVersion() => GetType().Assembly.GetName().Version.ToString();

        public void resetIndicator(int _) {
            assigned = false;
        }

        public void Unload() {
            assigned = false;
            Indicator indicator = GameObject.Find("Knight").GetComponent<Indicator>();
            if (indicator) {
                indicator.Unload();
                GameObject.DestroyImmediate(indicator);
            }
            ModHooks.HeroUpdateHook -= addIndicator;
            ModHooks.SavegameLoadHook -= resetIndicator;
        }

        private static void addIndicator() {
            if (!assigned) {
                GameObject.Find("Knight").AddComponent<Indicator>();
                assigned = true;
            }
        }
    }
}